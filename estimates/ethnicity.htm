<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>SANDAG Estimates - 2015 Race and Ethnicity</title>
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <style type="text/css">
            body {
              font-family: Verdana, Geneva, sans-serif;
              font-size: 12px;
              line-height: 18px;
            }

            .chart
            {
               font: 10px sans-serif;
            }
            
            .data_table
            {
              width: 100%;
              margin-top: 15px;
              margin-bottom: 15px;
              text-align: center;
            }
            
            .data_table table
            {
              margin: 0px auto;
            }
            
            .data_table h4
            {
              margin-bottom: 15px;
            }
            
            .numeric-cell
            {
              text-align: right;
            }
            
            .axis path,
            .axis line {
                fill: none;
                stroke: #000;
                shape-rendering: crispEdges;
            }

            .bar {
                fill: steelblue;
            }

            .x.axis path {
                display: none;
            }

            .ticks {
                color: orange;
            }

            select {
                position: absolute;
                top: 550px;
            }

            .data {
                position: absolute;
                top: 580px;
                width: 90%;
            }
        </style>
    </head>
    <body>
        <h1>INFO: SANDAG 2015 Estimates</h1>
        <a href="">Download Report</a>
        <div class="chart"></div>
        <h2>Ethnicity</h2>
        <div class="content">
        The 2010 Census revealed San Diego County has become a "majority-minority" county - meaning no single race or ethnic group comprises more than 50 percent of the total population. Between 
        2010 and 2015 the overall racial and ethnic composition of the region remained diverse. The Hispanic population increased by almost 88,000 people and the non-Hispanic Asian population increased
        by almost 30,000 people. Both of these groups represent about a 9 percent increase over the 2010 population. While the non-Hispanic black population in the region has shown slight increases in recent decades, between 2010 and 2015 the region's non-Hispanic black population declined by about 6 percent. Non-Hispanic whites increased by 1.1 percent, or about 16,000 persons, over the five-year period.
        </div>
        <div class="data_table">
        <h4>Table: Change in Racial and Ethnic Composition</h4>
        <table style="border-spacing: 0;border-collapse: collapse; align: center;">
          <tr>
            <td></td>
            <td colspan="2" style="text-align: center; border-bottom: 1px black solid">Population</td>
            <td colspan="2" style="text-align: center; border-bottom: 1px black solid">2010 - 2015 Change</td>
          </tr>
          <tr>
            <td style="width: 150px; text-align: right;"></td>
            <td style="width: 110px; text-align: right;">April 1, 2010</td>
            <td style="width: 110px; text-align: right;">January 1, 2015</td>
            <td style="width: 110px; text-align: right;">Numeric</td>
            <td style="width: 110px; text-align: right;">Percent Change</td>
          </tr>
          <tr>
            <td style="font-weight: bold; border-top: 1px black solid; text-align: left;">Total Population</td>
            <td class="numeric-cell" style="font-weight: bold; border-top: 1px black solid">3,095,313</td>
            <td class="numeric-cell" style="font-weight: bold; border-top: 1px black solid">3,227,492</td>
            <td class="numeric-cell" style="font-weight: bold; border-top: 1px black solid">132,179</td>
            <td class="numeric-cell" style="font-weight: bold; border-top: 1px black solid">4.3</td>
          </tr>
          <tr>
            <td style="padding-left: 5px; text-align: left;">Hispanic</td>
            <td class="numeric-cell">991,348</td>
            <td class="numeric-cell">1,078,955</td>
            <td class="numeric-cell">87,607</td>
            <td class="numeric-cell">8.8%</td>
          </tr>
          <tr>
            <td style="padding-left: 5px; text-align: left;">Non-Hispanic</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td style="padding-left: 15px; text-align: left;">White</td>
            <td class="numeric-cell">1,500,047</td>
            <td class="numeric-cell">1,515,945</td>
            <td class="numeric-cell">15,898</td>
            <td class="numeric-cell">1.1%</td>
          </tr>
          <tr>
            <td style="padding-left: 15px; text-align: left;">Black</td>
            <td class="numeric-cell">146,600</td>
            <td class="numeric-cell">138,206</td>
            <td class="numeric-cell">-8,394</td>
            <td class="numeric-cell">-5.7%</td>
          </tr>
          <tr>
            <td style="padding-left: 15px; text-align: left;">Asian</td>
            <td class="numeric-cell">328,058</td>
            <td class="numeric-cell">357,658</td>
            <td class="numeric-cell">29,600</td>
            <td class="numeric-cell">9.0%</td>
          </tr>
          <tr>
            <td style="padding-left: 15px; text-align: left;">Other</td>
            <td class="numeric-cell">129,260</td>
            <td class="numeric-cell">136,728</td>
            <td class="numeric-cell">7,468</td>
            <td class="numeric-cell">5.8%</td>
          </tr>
        </table>
        </div>
        <div class="content">
            Perhaps more interesting is the diversity in the racial and ethnic composition by jurisdiction in 2015 (chart at top of page). Eight jurisdictions have a higher percentage Hispanic population than does
            the San Diego region (Chula Vista, Escondido, Imperial Beach, Lemon Grove, National City, Oceanside, San Marcos and Vista). National City and San Diego City have the highest 
            percentages of non-Hispanic Asian residents with 17.1 percent and 16.4 percent, respectively. Out of 19 jurisdictions, Lemon Grove is the only city where non-Hispanic blacks 
            comprise more than 10 percent of the total population (11.2 percent). Only three jurisdictions have a non-Hispanic Asian population higher than the regional average of 11 percent: 
            Chula Vista, National City, and San Diego city. 
        </div>
        <script type="text/javascript">
            var jurisdictions = [];
            var count = [1];
            var widthRect = [1,2,3,4,5];
        
            var sd = {
              name: 'San Diego region'
              ,ethn: ['Hispanic', 'White', 'Black', 'Asian', 'Other']
              ,value: [0.3343, 0.4697, 0.0428, 0.1108, 0.0424]
            };
            
            var margin = {top: 20, right: 20, bottom: 30, left: 40},
                width = 700 - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;
            
            var x0 = d3.scale.ordinal()
                .rangeRoundBands([0, width], .1);
            
            var x1 = d3.scale.ordinal();
            
            var y = d3.scale.linear()
                .range([height, 0]);
            
            var color = d3.scale.ordinal()
                .range(["#d0743c", "#a05d56", "#6b486b", "#7b6888", "#8a89a6"])
            
            var xAxis = d3.svg.axis()
                .scale(x0)
                .orient("bottom");
                
            var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
                .tickFormat(d3.format("%"));
                
            d3.csv('http://sandag.github.io/estimates/race_ethnicity_2015.csv', function(error, data) {
                if (error) throw error;
                data.forEach(function(d) {
                    jurisdictions.push({
                        name: d.jurisdiction,
                        ethn: ['Hispanic', 'White', 'Black', 'Asian', 'Other'],
                        value: [d['hispanic'],d['white'],d['black'],d['asian'],d['other']]
                    });
                });
                
                var select = d3.select("body")
                    .append("div")
                    .append("select");
                
                select.on("change", function(d) {
                    var value = d3.select(this).property("value");
                    jurisdictions.forEach(function(d) {
                        render(d, value, svg);
                    });
                });
                
                select.selectAll("option")
                    .data(jurisdictions)
                    .enter()
                    .append("option")
                    .attr("value", function (d) { return d.name; })
                    .text(function(d) {return d.name;});
                
                var svg = d3.select("div.chart")
                    .append("svg")
                        .attr("width", width + margin.left + margin.right)
                        .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                
                x0.domain(['Choose Jurisdiction', sd.name]);
                x1.domain(sd.value).rangeRoundBands([0, x0.rangeBand()]);
                y.domain([0,1]);
                
                svg.append("g")
                    .attr("class", "x axis")
                    .attr("transform", "translate(0," + height + ")")
                    .call(xAxis);
                    
                svg.append("g")
                    .attr("class", "y axis")
                    .call(yAxis)
                    .append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .text("Percent");
                
                var jurisdiction = svg.selectAll('jurisdiction')
                    .data(count)
                    .enter()
                    .append("g")
                    .attr("class", "g")
                    .attr("transform", function (d) { return "translate(" + x0(sd.name) + ",0)"; });
                    
                jurisdiction.selectAll("rect")
                    .data(sd.value)
                    .enter().append("rect")
                    .attr("class", "bar")
                    .attr("width", x1.rangeBand())
                    .attr("x", function(d,i) {return x1(sd.value[i]) })
                    .attr("y", height)
                    .style("fill", function (d, i) {return color(sd.value[i]); })
                    .attr("height", 0)
                    .transition(1800)
                    .attr({
                        y: function (d, i) { return y(sd.value[i]); },
                        height: function (d, i) { return height - y(sd.value[i]); }
                    });
                
                var legend = svg.selectAll(".legend")
                    .data(sd.ethn.slice())
                    .enter()
                    .append("g")
                    .attr("class", "legend")
                    .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });
                
                legend.append("rect")
                    .attr("x", width - 18)
                    .attr("width", 18)
                    .attr("height", 18)
                    .style("fill", color);
                    
                legend.append("text")
                    .attr("x", width - 24)
                    .attr("y", 9)
                    .attr("dy", ".35em")
                    .style("text-anchor", "end")
                    .text(function(d) { return d; });
                
                function render(juris, value, svg) {
                    if (juris.name === value) {
                        var axis = svg.select(".x");
                        axis.remove();
                        var bars = svg.select(".selectJuris");
                        bars.remove();
                        
                        x0.domain([juris.name, sd.name]);
                        x1.domain(widthRect).rangeRoundBands([0, x0.rangeBand()]);
                        y.domain([0,1]);
                        
                        svg.append("g")
                            .attr("class", "x axis")
                            .attr("transform", "translate(0, " + height + ")")
                            .call(xAxis);
                        
                        var jurisdiction = svg.selectAll(".jurisdiction")
                            .data(count)
                            .enter()
                            .append("g")
                            .attr("class", "g selectJuris")
                            .attr("transform", function(d) {return "translate(" + x0(juris.name) + ",0)"; });
                        
                        jurisdiction.selectAll("rect")
                            .data(juris.value)
                            .enter()
                            .append("rect")
                            .attr("width", x1.rangeBand())
                            .attr("x", function (d, i) {return x1(widthRect[i]); })
                            .attr("y", height)
                            .style("fill", function(d, i) {return color(widthRect[i]); })
                            .attr("height", 0)
                            .transition()
                            .duration(1800)
                            .attr({ y: function (d, i) { return y(juris.value[i]); },
                                    height: function (d, i) { return height - y(juris.value[i]); }
                            });
                    }
                }
            });
        </script>
    </body>
</html>